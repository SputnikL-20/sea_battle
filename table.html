<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href="toast.min.css" rel="stylesheet">
	<script src="toast.min.js"></script>
    <title>Document</title>

    <style>
        table{
            border-collapse: collapse;
            border-spacing: 0;
        }

        th, td {
			width: 16px;
			height: 16px;
			font-size: 80%;
            padding: 1px 1px 1px 1px;
			margin: 1px 1px 1px 1px;
            border: 1px solid #000;
			cursor: crosshair;
        }
        canvas{
			font-size: 80%;

			margin: 0px 4px 0px 4px;
			/* background:gray;
            border: none;
			  cursor: crosshair; */
        }
    </style>
    <script type="text/javascript">

    function oneFourShip() {
	
		var x = 0;
		var map_ship = [];
		var verification = [];

		for (var i = 0; i < 4; i++) { 
			x = mapShipRandom();
			map_ship.push(x);
		  
			if ( map_ship.length == 0 ) {
				map_ship.push(x);
			} else {
				do {
					var count = 0;
					for (var v = 0; v < verification.length; v++) {
						if ( verification[v] == map_ship[i] ) {
							count++;
						}
					}
					if ( count > 0 ) {
						map_ship.pop();
						map_ship.push( mapShipRandom() );
					}
				} while ( count != 0 ); 
			}
		  
			var mas_check = [-1, -11, -10, -9, 1, 11, 10, 9];
			for ( var j = 0; j < mas_check.length; j++) {
				var tmp = Number(map_ship[i]) + mas_check[j];
				if ( String(tmp).length == 1 ) {
					tmp = "0" + tmp;
				}       
				verification.push(String(tmp));
			}
			verification.push( map_ship[i] );	
		}
		// console.log(map_ship);
		return map_ship;
    }

	function twoThreeShip(map_ship) {

		do {

			var x = 0;
			var two_ship = [];
			var count = 0;
			x = mapShipRandom();

			var two_ver_left = ['00', '10', '20', '30', '40', '50', '60', '70', '80', '90'];
			if ( two_ver_left.includes(x) ) {
				count++;
			}
			
			var borders_ship_left = [-10, -9, 1, 11, 10, 9, 8, -2, -12, -11];
			for (var i = 0; i < borders_ship_left.length; i++) {

				var tmp = (Number(x) + borders_ship_left[i]);
				if ( tmp.toString().length == 1 ) {
				  tmp = "0" + tmp;
				}	
				if ( map_ship.includes( tmp.toString() ) ) {
					count++;
				}
				map_ship.includes( x ) ? count++ : null;			
				map_ship.includes( (Number(x) - 1).toString() ) ? count++ : null;
				
				// console.log(count);
			}

			if ( count == 0 ) {
				var tmp = (Number(x) - 1).toString();
				if ( tmp.toString().length == 1 ) {
				  tmp = "0" + tmp;
				}
				two_ship.push(tmp);
				two_ship.push(x);
				// console.log(two_ship);
				return two_ship;

			} else if ( count != 0 ) {
			
				count = 0;			
				var two_ver_up = ['00', '01', '02', '03', '04', '05', '06', '07', '08' ,'09'];
				if ( two_ver_up.includes(x) ) {
					count++;
				}
				
				var borders_ship_up = [-1, -11, -21, -20, -19, -9, 1, 11, 10, 9];
				for (var i = 0; i < borders_ship_up.length; i++) {

					var tmp = (Number(x) + borders_ship_up[i]);
					if ( tmp.toString().length == 1 ) {
					  tmp = "0" + tmp;
					}		
					if ( map_ship.includes(tmp.toString()) ) {
						count++;
					}
					map_ship.includes( x ) ? count++ : null;			
					map_ship.includes( (Number(x) - 10).toString().length == 1 ? "0" + (Number(x) - 10).toString() : (Number(x) - 10).toString() ) ? count++ : null;
					
					// console.log(count);
				}

				if ( count == 0 ) {

					var tmp = (Number(x) - 10).toString();
					if ( tmp.toString().length == 1 ) {
					  tmp = "0" + tmp;
					}	
					two_ship.push(tmp);
					two_ship.push(x);
					// console.log(two_ship);
					return two_ship;
				}
			}

		} while ( count != 0 );
	}

	function mapShipRandom() {

		var x = Math.floor(Math.random() * 100);
		if ( String(x).length == 1 ) {
			x = "0" + x;
		}
		return x.toString();
	}   	
	
	function drawPast( id_canvas ) {
		var canvas = document.getElementById( id_canvas );
		try {
			if (canvas.getContext) {
				var ctx = canvas.getContext('2d');
				ctx.fillRect(0, 0, 8, 8);
			}		
		} catch (e) {
			null;
		}
	}

    </script>
</head>
<body id="body">
<div style="display: none;" id="use_ship"></div>	
<div style="display: none;" id="cpu_ship"></div>
<div style="display: none;" id="cpu_map_fire">[]</div>	
<div id="use">
	USE the fleet is destroyed on 0 %
</div>
<br />
<div id="user">
	<script>

		document.writeln("<table>");		
		for (var j = 0; j < 10; j++) {
			document.writeln("<tr>");
			if ( j == 0 ) {
				document.writeln("<th></th>");
				for (var l = 0; l < 10; l++) {
					document.writeln("<th>" + String.fromCodePoint(97 + l) + "</th>");
				}
				document.writeln("</tr>");
				document.writeln("<tr>");
			}
			document.writeln("<td style='text-align:center;font-weight:bold;'>" + String.fromCodePoint(48 + j) + "</td>");
			for (var i = 0; i < 10; i++) {
				document.writeln("<td id=" + j + "" + i + "><canvas id='use_canvas" + j + "" + i + "' width='8' height='8'></canvas></td>");
			}
			document.writeln("</tr>");
		}
		document.writeln("</table>");
		
		var use_map_ship = oneFourShip();
		var two_ship = [];

		for ( var ship of use_map_ship ) {
			document.getElementById(ship).style.backgroundColor = "blue";
		}

		for (var j = 0; j < 3; j++) {
			two_ship = twoThreeShip(use_map_ship);
			for ( var tw_ship of two_ship ) {
				document.getElementById(tw_ship).style.backgroundColor = "blue";
			}

			for (var i of two_ship) {
				use_map_ship.push(i);
			} ;
		}
		document.getElementById('use_ship').innerText = window.btoa( JSON.stringify(use_map_ship) );
		
	</script>
</div>
<br />
<div id="cpu">
	CPU the fleet is destroyed on 0 %
</div>
<br />
<div id="pc">	
	<script>
/*** cpu-x ***/		
		
		document.writeln("<table>");		
		for (var j = 0; j < 10; j++) {
			document.writeln("<tr>");
			if ( j == 0 ) {
				document.writeln("<th></th>");
				for (var l = 0; l < 10; l++) {
					document.writeln("<th>" + String.fromCodePoint(97 + l) + "</th>");
				}
				document.writeln("</tr>");
				document.writeln("<tr>");
			}
			document.writeln("<td style='text-align:center;font-weight:bold;'>" + String.fromCodePoint(48 + j) + "</td>");
			for (var i = 0; i < 10; i++) {
				document.writeln("<td id=" + j + "" + i + "cpu-x" + " onclick='setFire(this)'><canvas id='cpu_canvas" + j + "" + i + "' width='8' height='8'></canvas></td>");
			}
			document.writeln("</tr>");
		}
		document.writeln("</table>");
/*** end cpu-x ***/
		
		var cpu_map_ship = oneFourShip();
		var two_ship = [];

		for ( var ship of cpu_map_ship ) {
			document.getElementById(ship + "cpu-x").style.backgroundColor = "white";
		}

		for (var j = 0; j < 3; j++) {
			two_ship = twoThreeShip(cpu_map_ship);
			
			for ( var tw_ship of two_ship ) {
				document.getElementById(tw_ship + "cpu-x").style.backgroundColor = "white";
			}

			for (var i of two_ship) {
				cpu_map_ship.push(i);
			} 
		}
		document.getElementById('cpu_ship').innerText = window.btoa( JSON.stringify(cpu_map_ship) );
		
	</script>
</div>
<div id="communication">

	<script>
		
	console.log(use_map_ship);
	console.log(cpu_map_ship);
		
	function setFire(arg) {
	
		//console.log(arg);
		var cell = document.getElementById( arg.getAttribute('id') );		
		var fire = arg.getAttribute('id').slice(0, 2);
		var id_canvas = cell.childNodes[0].getAttribute('id');
		// console.log("pset_on_field_cpu: " + fire);
		var cpu_ship = JSON.parse( window.atob( document.getElementById('cpu_ship').innerText ) );

		if ( cpu_ship.includes( fire ) ) {
			cpu_ship.forEach( (item, index) => {
			  item == fire ? cpu_ship.splice( index, 1 ) : null;	  
			  document.getElementById('cpu_ship').innerText = window.btoa( JSON.stringify( cpu_ship ) );
			  document.getElementById('cpu').innerHTML = "CPU the fleet is destroyed on " + ((10 - cpu_ship.length) * 10) + " %";
			});

			cell.style.backgroundColor = "red";
			my_toast("use exactly");
			
		} else {
		my_toast("use off target");
		drawPast( id_canvas );
		document.getElementById("pc").style.pointerEvents = "none";
		// console.log("use off target");
		setTimeout ( function(){ setFireCPU() }, 1500 );
		}
	}
	
	function setFireCPU() {
		
		var cell_field;			
		var use_ship = JSON.parse( window.atob( document.getElementById('use_ship').innerText ) );
		var map_fire = JSON.parse( document.getElementById('cpu_map_fire').innerText );
		
		do {
			var j = 0;
			cell_field = Math.floor(Math.random() * 100);
			cell_field.toString().length == 1 ? cell_field = "0" + cell_field : cell_field.toString();
			
			for ( var arg of map_fire ) {
				arg == cell_field ? j = 1 : null;
			}
			map_fire.push( cell_field.toString() );
			document.getElementById('cpu_map_fire').innerText = JSON.stringify( map_fire );
			
		} while ( j != 0 );

		// console.log("pset_on_field_use: " + cell_field );
		
		var id_canvas = "use_canvas" +  cell_field;
		
		if ( use_ship.includes( cell_field.toString() ) ) {
		
			use_ship.forEach( (item, index) => {
			  item == cell_field.toString() ? use_ship.splice( index, 1 ) : null;
			  document.getElementById('use_ship').innerText = window.btoa( JSON.stringify( use_ship ) );
			  document.getElementById('use').innerHTML = "USE the fleet is destroyed on " + ((10 - use_ship.length) * 10) + " %";
			});
			
			document.getElementById( cell_field.toString() ).style.backgroundColor = "red";
			my_toast("cpu exactly");
			setTimeout ( function(){ setFireCPU() }, 1500 );
			
			// setTimeout ( 'document.getElementById("' + cell_field.toString() + '").style.backgroundColor = "red"', 3000);
			// console.log("cpu exactly");

		} else {	
			// setTimeout ( drawPast( id_canvas ), 5000);
			
			my_toast("cpu off target");		
			drawPast( id_canvas );
			// console.log("cpu off target");
			document.getElementById("pc").style.pointerEvents = "auto";
		}			
		
	}
	
	function my_toast(arg) {
		new Toast({
			title: false,
			text: arg,
			theme: "secondary",
			autohide: true,
			interval: 1000
		  });
	}
		
		// console.log(batle_arr);
	</script>
</div>

  <!-- <div style="max-width: 280px; padding: 15px; border: 1px solid #f5f5f5;"> -->
    <!-- <div style="margin-bottom: 0.5rem;"> -->
      <!-- Название заголовка: -->
      <!-- <input name="toast-title" type="text" value="Заголовок" style="width: 100%;"> -->
    <!-- </div> -->
    <!-- <div style="margin-bottom: 0.5rem;"> -->
      <!-- <input name="toast-without-title" type="checkbox">без заголовка -->
    <!-- </div> -->
    <!-- <div style="margin-bottom: 0.5rem;"> -->
      <!-- Текст сообщения: -->
      <!-- <input name="toast-text" type="text" value="Сообщение..." style="width: 100%;"> -->
    <!-- </div> -->
    <!-- <div style="margin-bottom: 0.5rem;"> -->
      <!-- Тема: -->
      <!-- <select class="form-control" name="toast-theme" style="width: 100%;"> -->
        <!-- <option selected value="default">default</option> -->
        <!-- <option value="primary">primary</option> -->
        <!-- <option value="secondary">secondary</option> -->
        <!-- <option value="success">success</option> -->
        <!-- <option value="danger">danger</option> -->
        <!-- <option value="warning">warning</option> -->
        <!-- <option value="info">info</option> -->
        <!-- <option value="light">light</option> -->
        <!-- <option value="dark">dark</option> -->
      <!-- </select> -->
    <!-- </div> -->
    <!-- <div style="margin-bottom: 0.5rem;"> -->
      <!-- <input name="toast-autohide" type="checkbox" checked>автоматически скрывать -->
    <!-- </div> -->
    <!-- <div style="margin-bottom: 0.5rem;"> -->
      <!-- Скрывать через (миллисекунд): -->
      <!-- <input name="toast-interval" type="text" value="10000" style="width: 100%;"> -->
    <!-- </div> -->
    <!-- <div style="margin-bottom: 0.5rem;"> -->
      <!-- <button id="add-toast" type="button" style="width: 100%;">Добавить toast</button> -->
    <!-- </div> -->
  <!-- </div> -->
  
  <!-- <script> -->
    <!-- document.querySelector('[name="toast-without-title"]').onchange = (e) => { -->
      <!-- document.querySelector('[name="toast-title"]').disabled = e.target.checked; -->
    <!-- } -->

    <!-- document.addEventListener('hide.toast', (e) => { -->
      <!-- console.log(e.detail.target); -->
    <!-- }); -->

    <!-- document.querySelector('#add-toast').onclick = () => { -->
      <!-- /* -->
        <!-- title - название заголовка -->
        <!-- text - текст сообщения -->
        <!-- theme - тема -->
        <!-- autohide - нужно ли автоматически скрыть всплывающее сообщение через interval миллисекунд interval - количество миллисекунд через которые необходимо скрыть сообщение -->
      <!-- */ -->
      <!-- new Toast({ -->
        <!-- title: document.querySelector('[name="toast-without-title"]').checked === true ? -->
          <!-- false : document.querySelector('[name="toast-title"]').value, -->
        <!-- text: document.querySelector('[name="toast-text"]').value, -->
        <!-- theme: document.querySelector('[name="toast-theme"] option:checked').value, -->
        <!-- autohide: document.querySelector('[name="toast-autohide"]').checked, -->
        <!-- interval: parseInt(document.querySelector('[name="toast-interval"]').value) -->
      <!-- }); -->
    <!-- } -->
  <!-- </script> -->
	<script>
		document.getElementById("user").style.pointerEvents = "none";
	</script>
</body>
</html>
